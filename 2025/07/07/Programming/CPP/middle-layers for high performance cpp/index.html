<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="C++ ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œä¹‹é—´æä¾›é€šä¿¡ã€æ•°æ®å¤„ç†å’Œåˆ†å¸ƒå¼æ”¯æŒçš„ç»„ä»¶ã€‚ç‰¹åˆ«åœ¨é«˜æ€§èƒ½ç¼–ç¨‹ä¸­ï¼ŒC++ çš„ä¸­é—´ä»¶å¸¸ç”¨äº åˆ†å¸ƒå¼ç³»ç»Ÿã€å®æ—¶é€šä¿¡ã€æ¶ˆæ¯ä¼ é€’ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€å…±äº«å†…å­˜ã€å¹¶å‘è°ƒåº¦ç­‰åœºæ™¯ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¹¿æ³›ä½¿ç”¨ã€é€‚ç”¨äºé«˜æ€§èƒ½ç¼–ç¨‹çš„ C++ ä¸­é—´ä»¶ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»æ•´ç†ï¼š  ğŸ” æ¶ˆæ¯é˜Ÿåˆ— &#x2F; æ¶ˆæ¯ä¸­é—´ä»¶   åç§° ç‰¹ç‚¹ æ€§èƒ½ åè®®æ”¯æŒ    ZeroMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2025/07/07/Programming/CPP/middle-layers%20for%20high%20performance%20cpp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="C++ ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œä¹‹é—´æä¾›é€šä¿¡ã€æ•°æ®å¤„ç†å’Œåˆ†å¸ƒå¼æ”¯æŒçš„ç»„ä»¶ã€‚ç‰¹åˆ«åœ¨é«˜æ€§èƒ½ç¼–ç¨‹ä¸­ï¼ŒC++ çš„ä¸­é—´ä»¶å¸¸ç”¨äº åˆ†å¸ƒå¼ç³»ç»Ÿã€å®æ—¶é€šä¿¡ã€æ¶ˆæ¯ä¼ é€’ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€å…±äº«å†…å­˜ã€å¹¶å‘è°ƒåº¦ç­‰åœºæ™¯ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¹¿æ³›ä½¿ç”¨ã€é€‚ç”¨äºé«˜æ€§èƒ½ç¼–ç¨‹çš„ C++ ä¸­é—´ä»¶ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»æ•´ç†ï¼š  ğŸ” æ¶ˆæ¯é˜Ÿåˆ— &#x2F; æ¶ˆæ¯ä¸­é—´ä»¶   åç§° ç‰¹ç‚¹ æ€§èƒ½ åè®®æ”¯æŒ    ZeroMQ">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-07-07T02:12:35.768Z">
<meta property="article:modified_time" content="2025-07-08T09:20:48.962Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

  
  <!-- Mermaid -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose',
      themeVariables: {
        primaryColor: '#0f4c75',
        primaryTextColor: '#fff',
        primaryBorderColor: '#0f4c75',
        lineColor: '#0f4c75',
        secondaryColor: '#006ba6',
        tertiaryColor: '#fff'
      }
    });
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Programming/CPP/middle-layers for high performance cpp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/07/07/Programming/CPP/middle-layers%20for%20high%20performance%20cpp/" class="article-date">
  <time class="dt-published" datetime="2025-07-07T02:12:35.768Z" itemprop="datePublished">2025-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>C++ ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œä¹‹é—´æä¾›é€šä¿¡ã€æ•°æ®å¤„ç†å’Œåˆ†å¸ƒå¼æ”¯æŒçš„ç»„ä»¶ã€‚ç‰¹åˆ«åœ¨é«˜æ€§èƒ½ç¼–ç¨‹ä¸­ï¼ŒC++ çš„ä¸­é—´ä»¶å¸¸ç”¨äº <strong>åˆ†å¸ƒå¼ç³»ç»Ÿã€å®æ—¶é€šä¿¡ã€æ¶ˆæ¯ä¼ é€’ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€å…±äº«å†…å­˜ã€å¹¶å‘è°ƒåº¦ç­‰åœºæ™¯</strong>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¹¿æ³›ä½¿ç”¨ã€é€‚ç”¨äºé«˜æ€§èƒ½ç¼–ç¨‹çš„ C++ ä¸­é—´ä»¶ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»æ•´ç†ï¼š</p>
<hr>
<h3 id="ğŸ”-æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#ğŸ”-æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="ğŸ” æ¶ˆæ¯é˜Ÿåˆ— &#x2F; æ¶ˆæ¯ä¸­é—´ä»¶"></a>ğŸ” <strong>æ¶ˆæ¯é˜Ÿåˆ— &#x2F; æ¶ˆæ¯ä¸­é—´ä»¶</strong></h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>æ€§èƒ½</th>
<th>åè®®æ”¯æŒ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ZeroMQ</strong></td>
<td>è½»é‡çº§æ¶ˆæ¯ä¼ è¾“åº“ï¼Œæé«˜æ€§èƒ½ï¼Œæ”¯æŒå¤šç§é€šä¿¡æ¨¡å¼ï¼ˆPUB&#x2F;SUB, REQ&#x2F;REP ç­‰ï¼‰</td>
<td>éå¸¸é«˜</td>
<td>TCP, IPC, inproc</td>
</tr>
<tr>
<td><strong>Nanomsg &#x2F; NNG</strong></td>
<td>ZeroMQ çš„åç»­é¡¹ç›®ï¼Œæ›´ç®€æ´ APIã€æ›´å¥½çš„çº¿ç¨‹æ¨¡å‹</td>
<td>é«˜</td>
<td>TCP, IPC</td>
</tr>
<tr>
<td><strong>RabbitMQï¼ˆC++å®¢æˆ·ç«¯ï¼‰</strong></td>
<td>å¼ºå¤§çš„ AMQP æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé€‚åˆä¼ä¸šç³»ç»Ÿ</td>
<td>è¾ƒé«˜</td>
<td>AMQP</td>
</tr>
<tr>
<td><strong>Kafkaï¼ˆcppkafka, librdkafkaï¼‰</strong></td>
<td>é«˜ååé‡çš„åˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼Œé€‚åˆæµå¼æ•°æ®</td>
<td>æé«˜</td>
<td>è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®</td>
</tr>
<tr>
<td><strong>Redisï¼ˆhiredis, redis-plus-plusï¼‰</strong></td>
<td>è½»é‡ KV æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¯å®ç°ç®€å•é˜Ÿåˆ—</td>
<td>é«˜</td>
<td>RESP</td>
</tr>
</tbody></table>
<hr>
<h3 id="ğŸ“¦-RPC-æœåŠ¡æ¡†æ¶ï¼ˆRemote-Procedure-Callï¼‰"><a href="#ğŸ“¦-RPC-æœåŠ¡æ¡†æ¶ï¼ˆRemote-Procedure-Callï¼‰" class="headerlink" title="ğŸ“¦ RPC &#x2F; æœåŠ¡æ¡†æ¶ï¼ˆRemote Procedure Callï¼‰"></a>ğŸ“¦ <strong>RPC &#x2F; æœåŠ¡æ¡†æ¶ï¼ˆRemote Procedure Callï¼‰</strong></h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>æ€§èƒ½</th>
<th>è¯­è¨€äº’é€šæ€§</th>
</tr>
</thead>
<tbody><tr>
<td><strong>gRPC (C++ API)</strong></td>
<td>Google å¼€æºï¼ŒåŸºäº HTTP&#x2F;2 + Protobuf</td>
<td>é«˜</td>
<td>å¤šè¯­è¨€</td>
</tr>
<tr>
<td><strong>Thriftï¼ˆApacheï¼‰</strong></td>
<td>æ”¯æŒå¤šè¯­è¨€ï¼Œçµæ´»é«˜æ•ˆçš„ RPC æ¡†æ¶</td>
<td>é«˜</td>
<td>å¤šè¯­è¨€</td>
</tr>
<tr>
<td><strong>Capâ€™n Proto</strong></td>
<td>æ¯” Protobuf æ›´å¿«çš„åºåˆ—åŒ– + RPC</td>
<td>æé«˜</td>
<td>å¤šè¯­è¨€</td>
</tr>
<tr>
<td><strong>brpcï¼ˆç™¾åº¦ï¼‰</strong></td>
<td>æ”¯æŒå¤šåè®®ï¼ˆHTTP&#x2F;RPCï¼‰é«˜å¹¶å‘ RPC æ¡†æ¶</td>
<td>æé«˜ï¼ˆç”¨äºç™¾åº¦å†…éƒ¨ï¼‰</td>
<td>C++</td>
</tr>
<tr>
<td><strong>Tarsï¼ˆè…¾è®¯ï¼‰</strong></td>
<td>å¾®æœåŠ¡æ¡†æ¶ï¼Œå†…ç½®æœåŠ¡å‘ç°ã€é…ç½®ä¸­å¿ƒç­‰</td>
<td>é«˜</td>
<td>C++&#x2F;Java&#x2F;PHP ç­‰</td>
</tr>
</tbody></table>
<hr>
<h3 id="ğŸ”€-å…±äº«å†…å­˜-è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰"><a href="#ğŸ”€-å…±äº«å†…å­˜-è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰" class="headerlink" title="ğŸ”€ å…±äº«å†…å­˜ &#x2F; è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰"></a>ğŸ”€ <strong>å…±äº«å†…å­˜ &#x2F; è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰</strong></h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>åœºæ™¯</th>
<th>æ€§èƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Boost.Interprocess</strong></td>
<td>C++ æ ‡å‡†åº“é£æ ¼çš„å…±äº«å†…å­˜ã€ä¿¡å·é‡ç­‰</td>
<td>å•æœºé«˜æ•ˆé€šä¿¡</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>mmap + è‡ªå®šä¹‰åè®®</strong></td>
<td>åŸå§‹ã€çµæ´»ï¼Œéœ€è¦è‡ªè¡Œç®¡ç†</td>
<td>è¶…ä½å»¶è¿Ÿéœ€æ±‚</td>
<td>æé«˜</td>
</tr>
<tr>
<td><strong>OpenSplice &#x2F; RTI Connext (DDS)</strong></td>
<td>æ•°æ®åˆ†å‘æœåŠ¡ï¼ˆDDSï¼‰æ ‡å‡†ï¼Œå®ç°å®æ—¶é€šä¿¡</td>
<td>å®æ—¶ç³»ç»Ÿã€èˆªç©ºã€è½¦è½½</td>
<td>é«˜</td>
</tr>
</tbody></table>
<hr>
<h3 id="â›“ï¸-åç¨‹-å¹¶å‘ä¸­é—´ä»¶"><a href="#â›“ï¸-åç¨‹-å¹¶å‘ä¸­é—´ä»¶" class="headerlink" title="â›“ï¸ åç¨‹ &#x2F; å¹¶å‘ä¸­é—´ä»¶"></a>â›“ï¸ <strong>åç¨‹ &#x2F; å¹¶å‘ä¸­é—´ä»¶</strong></h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>libgoï¼ˆè…¾è®¯ï¼‰</strong></td>
<td>åŸºäºC++åç¨‹è°ƒåº¦å™¨ï¼Œå…¼å®¹ Boost&#x2F;Go é£æ ¼ API</td>
<td>å¹¶å‘å¤§é‡ IO è¯·æ±‚</td>
</tr>
<tr>
<td><strong>libtask</strong></td>
<td>åç¨‹åº“ï¼Œæ¨¡ä»¿ Go åç¨‹æ¨¡å‹</td>
<td>é«˜å¹¶å‘è½»é‡æœåŠ¡</td>
</tr>
<tr>
<td><strong>follyï¼ˆFacebookï¼‰</strong></td>
<td>åŒ…å«åç¨‹ã€å¼‚æ­¥ IOã€è°ƒåº¦å™¨ç­‰ç»„ä»¶</td>
<td>é«˜å¹¶å‘æœåŠ¡ï¼Œé…åˆ Wangle&#x2F;Proxygen</td>
</tr>
<tr>
<td><strong>asio &#x2F; Boost.Asio</strong></td>
<td>é«˜æ€§èƒ½å¼‚æ­¥ IO æ¡†æ¶ï¼Œæ”¯æŒåç¨‹</td>
<td>ç½‘ç»œç¼–ç¨‹åŸºç¡€è®¾æ–½</td>
</tr>
</tbody></table>
<hr>
<h3 id="ğŸ§±-ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶-å¾®æœåŠ¡ä¸­é—´ä»¶"><a href="#ğŸ§±-ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶-å¾®æœåŠ¡ä¸­é—´ä»¶" class="headerlink" title="ğŸ§± ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶ &#x2F; å¾®æœåŠ¡ä¸­é—´ä»¶"></a>ğŸ§± <strong>ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶ &#x2F; å¾®æœåŠ¡ä¸­é—´ä»¶</strong></h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Wangleï¼ˆFacebookï¼‰</strong></td>
<td>C++ ç½‘ç»œæœåŠ¡æ¡†æ¶ï¼ŒåŸºäº Futures å’Œ Pipeline</td>
<td>ç”¨äºæ„å»ºé«˜æ€§èƒ½ C++ ç½‘ç»œæœåŠ¡</td>
</tr>
<tr>
<td><strong>Restbed</strong></td>
<td>RESTful API æœåŠ¡æ¡†æ¶</td>
<td>è½»é‡ REST Server</td>
</tr>
<tr>
<td><strong>Seastarï¼ˆScyllaDBï¼‰</strong></td>
<td>åŸºäº C++20 çš„å¼‚æ­¥æ¡†æ¶ï¼Œæ ¸å¿ƒä¸ºæœªæ¥å¼ç¼–ç¨‹</td>
<td>è¶…é«˜å¹¶å‘æœåŠ¡å™¨ï¼Œå¦‚ ScyllaDB</td>
</tr>
</tbody></table>
<hr>
<h3 id="ğŸ”§-åºåˆ—åŒ–æ¡†æ¶ï¼ˆé€šå¸¸é…åˆä¸­é—´ä»¶ä½¿ç”¨ï¼‰"><a href="#ğŸ”§-åºåˆ—åŒ–æ¡†æ¶ï¼ˆé€šå¸¸é…åˆä¸­é—´ä»¶ä½¿ç”¨ï¼‰" class="headerlink" title="ğŸ”§ åºåˆ—åŒ–æ¡†æ¶ï¼ˆé€šå¸¸é…åˆä¸­é—´ä»¶ä½¿ç”¨ï¼‰"></a>ğŸ”§ <strong>åºåˆ—åŒ–æ¡†æ¶ï¼ˆé€šå¸¸é…åˆä¸­é—´ä»¶ä½¿ç”¨ï¼‰</strong></h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>æ€§èƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Protobuf</strong></td>
<td>Google æ ‡å‡†ï¼Œå¹¿æ³›ä½¿ç”¨</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>FlatBuffers</strong></td>
<td>Zero-Copyï¼Œé€‚åˆæ¸¸æˆ&#x2F;å®æ—¶åº”ç”¨</td>
<td>æé«˜</td>
</tr>
<tr>
<td><strong>Capâ€™n Proto</strong></td>
<td>é›¶æ‹·è´è®¾è®¡ï¼Œæ¯” Protobuf å¿«</td>
<td>æé«˜</td>
</tr>
<tr>
<td><strong>MessagePack</strong></td>
<td>ç´§å‡‘äºŒè¿›åˆ¶ JSON</td>
<td>é«˜</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ¯-è¯¦ç»†ä¸šåŠ¡åœºæ™¯åº”ç”¨"><a href="#ğŸ¯-è¯¦ç»†ä¸šåŠ¡åœºæ™¯åº”ç”¨" class="headerlink" title="ğŸ¯ è¯¦ç»†ä¸šåŠ¡åœºæ™¯åº”ç”¨"></a>ğŸ¯ è¯¦ç»†ä¸šåŠ¡åœºæ™¯åº”ç”¨</h2><h3 id="ğŸ”-æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆæ¯ä¸­é—´ä»¶åº”ç”¨åœºæ™¯"><a href="#ğŸ”-æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆæ¯ä¸­é—´ä»¶åº”ç”¨åœºæ™¯" class="headerlink" title="ğŸ” æ¶ˆæ¯é˜Ÿåˆ—&#x2F;æ¶ˆæ¯ä¸­é—´ä»¶åº”ç”¨åœºæ™¯"></a>ğŸ” æ¶ˆæ¯é˜Ÿåˆ—&#x2F;æ¶ˆæ¯ä¸­é—´ä»¶åº”ç”¨åœºæ™¯</h3><h4 id="ZeroMQ-Nanomsg"><a href="#ZeroMQ-Nanomsg" class="headerlink" title="ZeroMQ &#x2F; Nanomsg"></a>ZeroMQ &#x2F; Nanomsg</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>é‡‘èäº¤æ˜“ç³»ç»Ÿ</strong>ï¼šé«˜é¢‘äº¤æ˜“ä¸­çš„è®¢å•è·¯ç”±ï¼Œéœ€è¦å¾®ç§’çº§å»¶è¿Ÿ</li>
<li><strong>æ¸¸æˆæœåŠ¡å™¨</strong>ï¼šç©å®¶çŠ¶æ€åŒæ­¥ã€èŠå¤©ç³»ç»Ÿ</li>
<li><strong>IoTè®¾å¤‡é€šä¿¡</strong>ï¼šä¼ æ„Ÿå™¨æ•°æ®æ”¶é›†å’ŒæŒ‡ä»¤ä¸‹å‘</li>
<li><strong>å®æ—¶ç›‘æ§ç³»ç»Ÿ</strong>ï¼šæ—¥å¿—æ”¶é›†ã€æ€§èƒ½æŒ‡æ ‡ä¼ è¾“</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;zmq.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œé€‚ç”¨äºå¹¿æ’­åœºæ™¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MarketDataPublisher</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    zmq::<span class="type">context_t</span> context_;</span><br><span class="line">    zmq::<span class="type">socket_t</span> publisher_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MarketDataPublisher</span>() : <span class="built_in">context_</span>(<span class="number">1</span>), <span class="built_in">publisher_</span>(context_, ZMQ_PUB) &#123;</span><br><span class="line">        publisher_.<span class="built_in">bind</span>(<span class="string">&quot;tcp://*:5556&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">publish_market_data</span><span class="params">(<span class="type">const</span> std::string&amp; symbol, <span class="type">double</span> price)</span> </span>&#123;</span><br><span class="line">        std::string message = symbol + <span class="string">&quot;:&quot;</span> + std::<span class="built_in">to_string</span>(price);</span><br><span class="line">        publisher_.<span class="built_in">send</span>(zmq::<span class="built_in">buffer</span>(message));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…è€…ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MarketDataSubscriber</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    zmq::<span class="type">context_t</span> context_;</span><br><span class="line">    zmq::<span class="type">socket_t</span> subscriber_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MarketDataSubscriber</span>() : <span class="built_in">context_</span>(<span class="number">1</span>), <span class="built_in">subscriber_</span>(context_, ZMQ_SUB) &#123;</span><br><span class="line">        subscriber_.<span class="built_in">connect</span>(<span class="string">&quot;tcp://localhost:5556&quot;</span>);</span><br><span class="line">        subscriber_.<span class="built_in">set</span>(zmq::sockopt::subscribe, <span class="string">&quot;AAPL&quot;</span>); <span class="comment">// è®¢é˜…ç‰¹å®šè‚¡ç¥¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">receive_data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        zmq::<span class="type">message_t</span> message;</span><br><span class="line">        subscriber_.<span class="built_in">recv</span>(&amp;message);</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">string</span>(<span class="built_in">static_cast</span>&lt;<span class="type">char</span>*&gt;(message.<span class="built_in">data</span>()), message.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Kafka-cppkafka"><a href="#Kafka-cppkafka" class="headerlink" title="Kafka (cppkafka)"></a>Kafka (cppkafka)</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>å¤§æ•°æ®æµå¤„ç†</strong>ï¼šç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ”¶é›†ã€ç‚¹å‡»æµåˆ†æ</li>
<li><strong>äº‹ä»¶é©±åŠ¨æ¶æ„</strong>ï¼šè®¢å•çŠ¶æ€å˜æ›´ã€åº“å­˜å˜åŒ–é€šçŸ¥</li>
<li><strong>æ•°æ®ç®¡é“</strong>ï¼šETLè¿‡ç¨‹ä¸­çš„æ•°æ®ä¼ è¾“</li>
<li><strong>å¾®æœåŠ¡é—´é€šä¿¡</strong>ï¼šæœåŠ¡è§£è€¦ã€å¼‚æ­¥å¤„ç†</li>
</ul>
<p><strong>ä¸šåŠ¡æ¡ˆä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cppkafka/cppkafka.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserEventCollector</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    cppkafka::Configuration config_;</span><br><span class="line">    cppkafka::Producer producer_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UserEventCollector</span>() : config_&#123;</span><br><span class="line">        &#123;<span class="string">&quot;metadata.broker.list&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;client.id&quot;</span>, <span class="string">&quot;user-event-collector&quot;</span>&#125;</span><br><span class="line">    &#125;, <span class="built_in">producer_</span>(config_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">track_user_action</span><span class="params">(<span class="type">const</span> std::string&amp; user_id, </span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> std::string&amp; action,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> std::string&amp; page)</span> </span>&#123;</span><br><span class="line">        json event = &#123;</span><br><span class="line">            &#123;<span class="string">&quot;user_id&quot;</span>, user_id&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;action&quot;</span>, action&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;timestamp&quot;</span>, <span class="built_in">get_current_timestamp</span>()&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;page&quot;</span>, page&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        std::string message = event.<span class="built_in">dump</span>();</span><br><span class="line">        producer_.<span class="built_in">produce</span>(cppkafka::<span class="built_in">MessageBuilder</span>(<span class="string">&quot;user-events&quot;</span>)</span><br><span class="line">                         .<span class="built_in">payload</span>(message));</span><br><span class="line">        producer_.<span class="built_in">flush</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">get_current_timestamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> now = std::chrono::system_clock::<span class="built_in">now</span>();</span><br><span class="line">        <span class="keyword">auto</span> <span class="type">time_t</span> = std::chrono::system_clock::<span class="built_in">to_time_t</span>(now);</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">ctime</span>(&amp;<span class="type">time_t</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ“¦-RPC-æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯"><a href="#ğŸ“¦-RPC-æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯" class="headerlink" title="ğŸ“¦ RPC&#x2F;æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯"></a>ğŸ“¦ RPC&#x2F;æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯</h3><h4 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šæœåŠ¡é—´APIè°ƒç”¨</li>
<li><strong>ç§»åŠ¨åº”ç”¨åç«¯</strong>ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡</li>
<li><strong>äº‘åŸç”Ÿåº”ç”¨</strong>ï¼šå®¹å™¨åŒ–æœåŠ¡é—´é€šä¿¡</li>
<li><strong>APIç½‘å…³</strong>ï¼šç»Ÿä¸€çš„æœåŠ¡å…¥å£</li>
</ul>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user_service.proto</span></span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line">package userservice;</span><br><span class="line"></span><br><span class="line">service UserService &#123;</span><br><span class="line">    <span class="function">rpc <span class="title">GetUser</span><span class="params">(GetUserRequest)</span> <span class="title">returns</span> <span class="params">(UserProfile)</span></span>;</span><br><span class="line">    <span class="function">rpc <span class="title">UpdateUser</span><span class="params">(UpdateUserRequest)</span> <span class="title">returns</span> <span class="params">(UserProfile)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message GetUserRequest &#123;</span><br><span class="line">    int32 user_id = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message UserProfile &#123;</span><br><span class="line">    int32 user_id = <span class="number">1</span>;</span><br><span class="line">    string name = <span class="number">2</span>;</span><br><span class="line">    string email = <span class="number">3</span>;</span><br><span class="line">    int64 created_at = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++ å®¢æˆ·ç«¯å®ç°</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;grpcpp/grpcpp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;user_service.grpc.pb.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceClient</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;UserService::Stub&gt; stub_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UserServiceClient</span>(std::shared_ptr&lt;grpc::Channel&gt; channel)</span><br><span class="line">        : <span class="built_in">stub_</span>(UserService::<span class="built_in">NewStub</span>(channel)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">UserProfile <span class="title">GetUserProfile</span><span class="params">(<span class="type">int</span> user_id)</span> </span>&#123;</span><br><span class="line">        GetUserRequest request;</span><br><span class="line">        request.<span class="built_in">set_user_id</span>(user_id);</span><br><span class="line">        </span><br><span class="line">        grpc::ClientContext context;</span><br><span class="line">        UserProfile response;</span><br><span class="line">        </span><br><span class="line">        grpc::Status status = stub_-&gt;<span class="built_in">GetUser</span>(&amp;context, request, &amp;response);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (status.<span class="built_in">ok</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;RPC failed: &quot;</span> + status.<span class="built_in">error_message</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">UpdateUserProfile</span><span class="params">(<span class="type">const</span> UserProfile&amp; profile)</span> </span>&#123;</span><br><span class="line">        UpdateUserRequest request;</span><br><span class="line">        request.<span class="built_in">mutable_user</span>()-&gt;<span class="built_in">CopyFrom</span>(profile);</span><br><span class="line">        </span><br><span class="line">        grpc::ClientContext context;</span><br><span class="line">        UserProfile response;</span><br><span class="line">        </span><br><span class="line">        grpc::Status status = stub_-&gt;<span class="built_in">UpdateUser</span>(&amp;context, request, &amp;response);</span><br><span class="line">        <span class="keyword">return</span> status.<span class="built_in">ok</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="brpc-ç™¾åº¦"><a href="#brpc-ç™¾åº¦" class="headerlink" title="brpc (ç™¾åº¦)"></a>brpc (ç™¾åº¦)</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>æœç´¢å¼•æ“</strong>ï¼šæŸ¥è¯¢å¤„ç†ã€ç´¢å¼•æ›´æ–°</li>
<li><strong>æ¨èç³»ç»Ÿ</strong>ï¼šç‰¹å¾è®¡ç®—ã€æ¨¡å‹æ¨ç†</li>
<li><strong>å¹¿å‘Šç³»ç»Ÿ</strong>ï¼šå®æ—¶ç«ä»·ã€å¹¿å‘ŠæŠ•æ”¾</li>
<li><strong>é«˜å¹¶å‘WebæœåŠ¡</strong>ï¼šAPIæœåŠ¡ã€æ•°æ®å¤„ç†</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;brpc/server.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;brpc/restful.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰RPCæœåŠ¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchService</span> : <span class="keyword">public</span> SearchServiceBase &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Search</span><span class="params">(google::protobuf::RpcController* cntl_base,</span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="type">const</span> SearchRequest* request,</span></span></span><br><span class="line"><span class="params"><span class="function">                SearchResponse* response,</span></span></span><br><span class="line"><span class="params"><span class="function">                google::protobuf::Closure* done)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="function">brpc::ClosureGuard <span class="title">done_guard</span><span class="params">(done)</span></span>;</span><br><span class="line">        brpc::Controller* cntl = <span class="built_in">static_cast</span>&lt;brpc::Controller*&gt;(cntl_base);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†æœç´¢è¯·æ±‚</span></span><br><span class="line">        std::string query = request-&gt;<span class="built_in">query</span>();</span><br><span class="line">        <span class="keyword">auto</span> results = search_engine_.<span class="built_in">search</span>(query);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¡«å……å“åº”</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; result : results) &#123;</span><br><span class="line">            <span class="keyword">auto</span>* item = response-&gt;<span class="built_in">add_results</span>();</span><br><span class="line">            item-&gt;<span class="built_in">set_title</span>(result.title);</span><br><span class="line">            item-&gt;<span class="built_in">set_url</span>(result.url);</span><br><span class="line">            item-&gt;<span class="built_in">set_snippet</span>(result.snippet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    SearchEngine search_engine_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    brpc::Server server;</span><br><span class="line">    SearchService search_service;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (server.<span class="built_in">AddService</span>(&amp;search_service, brpc::SERVER_DOESNT_OWN_SERVICE) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;Fail to add service&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    brpc::ServerOptions options;</span><br><span class="line">    <span class="keyword">if</span> (server.<span class="built_in">Start</span>(<span class="number">8000</span>, &amp;options) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;Fail to start server&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server.<span class="built_in">RunUntilAskedToQuit</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”€-å…±äº«å†…å­˜-è¿›ç¨‹é—´é€šä¿¡åº”ç”¨åœºæ™¯"><a href="#ğŸ”€-å…±äº«å†…å­˜-è¿›ç¨‹é—´é€šä¿¡åº”ç”¨åœºæ™¯" class="headerlink" title="ğŸ”€ å…±äº«å†…å­˜&#x2F;è¿›ç¨‹é—´é€šä¿¡åº”ç”¨åœºæ™¯"></a>ğŸ”€ å…±äº«å†…å­˜&#x2F;è¿›ç¨‹é—´é€šä¿¡åº”ç”¨åœºæ™¯</h3><h4 id="Boost-Interprocess"><a href="#Boost-Interprocess" class="headerlink" title="Boost.Interprocess"></a>Boost.Interprocess</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>æ•°æ®åº“ç³»ç»Ÿ</strong>ï¼šå†…å­˜è¡¨ã€ç¼“å­˜å±‚</li>
<li><strong>å›¾åƒå¤„ç†</strong>ï¼šå¤§å›¾åƒæ•°æ®å…±äº«</li>
<li><strong>ç§‘å­¦è®¡ç®—</strong>ï¼šå¤§å‹çŸ©é˜µè¿ç®—</li>
<li><strong>å®æ—¶ç³»ç»Ÿ</strong>ï¼šä½å»¶è¿Ÿæ•°æ®å¤„ç†</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;boost/interprocess/shared_memory_object.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;boost/interprocess/mapped_region.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;boost/interprocess/sync/named_mutex.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> boost::interprocess;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SharedMemoryCache</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    shared_memory_object shm_;</span><br><span class="line">    mapped_region region_;</span><br><span class="line">    named_mutex mutex_;</span><br><span class="line">    <span class="type">char</span>* data_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SharedMemoryCache</span>() </span><br><span class="line">        : <span class="built_in">shm_</span>(open_or_create, <span class="string">&quot;cache&quot;</span>, read_write)</span><br><span class="line">        , <span class="built_in">mutex_</span>(open_or_create, <span class="string">&quot;cache_mutex&quot;</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        shm_.<span class="built_in">truncate</span>(<span class="number">1024</span>*<span class="number">1024</span>); <span class="comment">// 1MB</span></span><br><span class="line">        region_ = <span class="built_in">mapped_region</span>(shm_, read_write);</span><br><span class="line">        data_ = <span class="built_in">static_cast</span>&lt;<span class="type">char</span>*&gt;(region_.<span class="built_in">get_address</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write_data</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::string&amp; value)</span> </span>&#123;</span><br><span class="line">        <span class="function">scoped_lock&lt;named_mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç®€å•çš„é”®å€¼å­˜å‚¨å®ç°</span></span><br><span class="line">        <span class="type">size_t</span> offset = <span class="built_in">hash_key</span>(key) % (<span class="number">1024</span>*<span class="number">1024</span> - <span class="number">100</span>);</span><br><span class="line">        std::string entry = key + <span class="string">&quot;:&quot;</span> + value + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::<span class="built_in">copy</span>(entry.<span class="built_in">begin</span>(), entry.<span class="built_in">end</span>(), data_ + offset);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">read_data</span><span class="params">(<span class="type">const</span> std::string&amp; key)</span> </span>&#123;</span><br><span class="line">        <span class="function">scoped_lock&lt;named_mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç®€å•çš„æŸ¥æ‰¾å®ç°</span></span><br><span class="line">        <span class="type">size_t</span> offset = <span class="built_in">hash_key</span>(key) % (<span class="number">1024</span>*<span class="number">1024</span> - <span class="number">100</span>);</span><br><span class="line">        <span class="function">std::string <span class="title">data</span><span class="params">(data_ + offset)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è§£æé”®å€¼å¯¹</span></span><br><span class="line">        <span class="type">size_t</span> pos = data.<span class="built_in">find</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos != std::string::npos) &#123;</span><br><span class="line">            std::string stored_key = data.<span class="built_in">substr</span>(<span class="number">0</span>, pos);</span><br><span class="line">            <span class="keyword">if</span> (stored_key == key) &#123;</span><br><span class="line">                <span class="type">size_t</span> end_pos = data.<span class="built_in">find</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> data.<span class="built_in">substr</span>(pos + <span class="number">1</span>, end_pos - pos - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">hash_key</span><span class="params">(<span class="type">const</span> std::string&amp; key)</span> </span>&#123;</span><br><span class="line">        std::hash&lt;std::string&gt; hasher;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hasher</span>(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="DDS-RTI-Connext"><a href="#DDS-RTI-Connext" class="headerlink" title="DDS (RTI Connext)"></a>DDS (RTI Connext)</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿ</strong>ï¼šä¼ æ„Ÿå™¨æ•°æ®åˆ†å‘</li>
<li><strong>èˆªç©ºèˆªå¤©</strong>ï¼šé£è¡Œæ§åˆ¶ç³»ç»Ÿ</li>
<li><strong>å·¥ä¸šè‡ªåŠ¨åŒ–</strong>ï¼šPLCé€šä¿¡</li>
<li><strong>åŒ»ç–—è®¾å¤‡</strong>ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿ</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dds/dds.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dds/topic/Topic.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dds/pub/Publisher.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dds/sub/Subscriber.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SensorData</span> &#123;</span><br><span class="line">    <span class="type">int</span> sensor_id;</span><br><span class="line">    <span class="type">double</span> temperature;</span><br><span class="line">    <span class="type">double</span> humidity;</span><br><span class="line">    <span class="type">long</span> timestamp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SensorDataPublisher</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    dds::domain::DomainParticipant participant_;</span><br><span class="line">    dds::topic::Topic&lt;SensorData&gt; topic_;</span><br><span class="line">    dds::pub::Publisher publisher_;</span><br><span class="line">    dds::pub::DataWriter&lt;SensorData&gt; writer_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SensorDataPublisher</span>() </span><br><span class="line">        : <span class="built_in">participant_</span>(<span class="number">0</span>)</span><br><span class="line">        , <span class="built_in">topic_</span>(participant_, <span class="string">&quot;SensorData&quot;</span>)</span><br><span class="line">        , <span class="built_in">publisher_</span>(participant_)</span><br><span class="line">        , <span class="built_in">writer_</span>(publisher_, topic_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">publish_sensor_data</span><span class="params">(<span class="type">int</span> sensor_id, <span class="type">double</span> temp, <span class="type">double</span> humidity)</span> </span>&#123;</span><br><span class="line">        SensorData data;</span><br><span class="line">        data.sensor_id = sensor_id;</span><br><span class="line">        data.temperature = temp;</span><br><span class="line">        data.humidity = humidity;</span><br><span class="line">        data.timestamp = <span class="built_in">get_current_time</span>();</span><br><span class="line">        </span><br><span class="line">        writer_.<span class="built_in">write</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="title">get_current_time</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(</span><br><span class="line">            std::chrono::system_clock::<span class="built_in">now</span>().<span class="built_in">time_since_epoch</span>()</span><br><span class="line">        ).<span class="built_in">count</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="â›“ï¸-åç¨‹-å¹¶å‘ä¸­é—´ä»¶åº”ç”¨åœºæ™¯"><a href="#â›“ï¸-åç¨‹-å¹¶å‘ä¸­é—´ä»¶åº”ç”¨åœºæ™¯" class="headerlink" title="â›“ï¸ åç¨‹&#x2F;å¹¶å‘ä¸­é—´ä»¶åº”ç”¨åœºæ™¯"></a>â›“ï¸ åç¨‹&#x2F;å¹¶å‘ä¸­é—´ä»¶åº”ç”¨åœºæ™¯</h3><h4 id="libgo"><a href="#libgo" class="headerlink" title="libgo"></a>libgo</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>WebæœåŠ¡å™¨</strong>ï¼šå¤„ç†å¤§é‡å¹¶å‘è¿æ¥</li>
<li><strong>ä»£ç†æœåŠ¡å™¨</strong>ï¼šè¯·æ±‚è½¬å‘ã€è´Ÿè½½å‡è¡¡</li>
<li><strong>APIç½‘å…³</strong>ï¼šè·¯ç”±ã€è®¤è¯ã€é™æµ</li>
<li><strong>èŠå¤©åº”ç”¨</strong>ï¼šæ¶ˆæ¯å¤„ç†ã€ç”¨æˆ·ä¼šè¯ç®¡ç†</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;libgo/libgo.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebServer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨åç¨‹å¤„ç†HTTPè¯·æ±‚</span></span><br><span class="line">        <span class="built_in">go</span>([<span class="keyword">this</span>]() &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">go</span>([<span class="keyword">this</span>, i]() &#123;</span><br><span class="line">                    <span class="built_in">handle_request</span>(i);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯åŠ¨åç¨‹å¤„ç†WebSocketè¿æ¥</span></span><br><span class="line">        <span class="built_in">go</span>([<span class="keyword">this</span>]() &#123;</span><br><span class="line">            <span class="built_in">handle_websocket_connections</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯åŠ¨åç¨‹è¿›è¡Œå¥åº·æ£€æŸ¥</span></span><br><span class="line">        <span class="built_in">go</span>([<span class="keyword">this</span>]() &#123;</span><br><span class="line">            <span class="built_in">health_check_loop</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle_request</span><span class="params">(<span class="type">int</span> request_id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹ŸHTTPè¯·æ±‚å¤„ç†</span></span><br><span class="line">        std::string response = <span class="built_in">process_request</span>(request_id);</span><br><span class="line">        <span class="built_in">send_response</span>(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle_websocket_connections</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†WebSocketæ¶ˆæ¯</span></span><br><span class="line">            std::string message = <span class="built_in">receive_websocket_message</span>();</span><br><span class="line">            <span class="built_in">go</span>([<span class="keyword">this</span>, message]() &#123;</span><br><span class="line">                <span class="built_in">process_websocket_message</span>(message);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">health_check_loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="built_in">co_sleep</span>(<span class="number">5000</span>); <span class="comment">// 5ç§’æ£€æŸ¥ä¸€æ¬¡</span></span><br><span class="line">            <span class="built_in">check_system_health</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">process_request</span><span class="params">(<span class="type">int</span> request_id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿè¯·æ±‚å¤„ç†é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Response for request &quot;</span> + std::<span class="built_in">to_string</span>(request_id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">send_response</span><span class="params">(<span class="type">const</span> std::string&amp; response)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å‘é€HTTPå“åº”</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Sending response: &quot;</span> &lt;&lt; response &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">receive_websocket_message</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¥æ”¶WebSocketæ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;WebSocket message&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">process_websocket_message</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¤„ç†WebSocketæ¶ˆæ¯</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Processing WebSocket message: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_system_health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç³»ç»Ÿå¥åº·æ£€æŸ¥</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Performing health check...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Seastar"><a href="#Seastar" class="headerlink" title="Seastar"></a>Seastar</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>NoSQLæ•°æ®åº“</strong>ï¼šå¦‚ScyllaDB</li>
<li><strong>æµå¤„ç†å¼•æ“</strong>ï¼šå®æ—¶æ•°æ®å¤„ç†</li>
<li><strong>ç¼“å­˜ç³»ç»Ÿ</strong>ï¼šé«˜æ€§èƒ½å†…å­˜ç¼“å­˜</li>
<li><strong>CDNèŠ‚ç‚¹</strong>ï¼šå†…å®¹åˆ†å‘ç½‘ç»œ</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seastar/core/app-template.hh&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seastar/core/reactor.hh&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seastar/http/httpd.hh&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seastar/http/handlers.hh&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    seastar::httpd::http_server server_;</span><br><span class="line">    std::unordered_map&lt;std::string, std::string&gt; cache_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    seastar::future&lt;&gt; <span class="built_in">start</span>() &#123;</span><br><span class="line">        server_.<span class="built_in">set_routes</span>([<span class="keyword">this</span>](seastar::httpd::routes&amp; r) &#123;</span><br><span class="line">            r.<span class="built_in">add</span>(seastar::httpd::operation_type::GET, <span class="string">&quot;/cache/&#123;key&#125;&quot;</span>, </span><br><span class="line">                  [<span class="keyword">this</span>](seastar::httpd::const_req&amp; req) &#123;</span><br><span class="line">                      <span class="keyword">return</span> <span class="built_in">get_cache_value</span>(req.param[<span class="string">&quot;key&quot;</span>]);</span><br><span class="line">                  &#125;);</span><br><span class="line">            </span><br><span class="line">            r.<span class="built_in">add</span>(seastar::httpd::operation_type::PUT, <span class="string">&quot;/cache/&#123;key&#125;&quot;</span>, </span><br><span class="line">                  [<span class="keyword">this</span>](seastar::httpd::const_req&amp; req) &#123;</span><br><span class="line">                      <span class="keyword">return</span> <span class="built_in">set_cache_value</span>(req.param[<span class="string">&quot;key&quot;</span>], req.content);</span><br><span class="line">                  &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> server_.<span class="built_in">listen</span>(seastar::socket_address&#123;<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8080</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">get_cache_value</span><span class="params">(<span class="type">const</span> std::string&amp; key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = cache_.<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (it != cache_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> it-&gt;second;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Not found&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">set_cache_value</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::string&amp; value)</span> </span>&#123;</span><br><span class="line">        cache_[key] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    seastar::app_template app;</span><br><span class="line">    app.<span class="built_in">run</span>(argc, argv, []() &#123;</span><br><span class="line">        <span class="keyword">auto</span> cache_service = std::<span class="built_in">make_unique</span>&lt;CacheService&gt;();</span><br><span class="line">        <span class="keyword">return</span> cache_service-&gt;<span class="built_in">start</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ§±-ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯"><a href="#ğŸ§±-ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯" class="headerlink" title="ğŸ§± ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯"></a>ğŸ§± ç»„ä»¶åŒ–æœåŠ¡æ¡†æ¶åº”ç”¨åœºæ™¯</h3><h4 id="Wangle-Facebook"><a href="#Wangle-Facebook" class="headerlink" title="Wangle (Facebook)"></a>Wangle (Facebook)</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>ç¤¾äº¤ç½‘ç»œåç«¯</strong>ï¼šç”¨æˆ·å…³ç³»ã€å†…å®¹åˆ†å‘</li>
<li><strong>å¹¿å‘ŠæŠ•æ”¾ç³»ç»Ÿ</strong>ï¼šå®æ—¶ç«ä»·ã€åˆ›æ„æŠ•æ”¾</li>
<li><strong>æ¨èå¼•æ“</strong>ï¼šä¸ªæ€§åŒ–æ¨èæœåŠ¡</li>
<li><strong>APIæœåŠ¡</strong>ï¼šRESTful APIæœåŠ¡</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wangle/bootstrap/ServerBootstrap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wangle/channel/AsyncSocketHandler.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wangle/codec/LineBasedFrameDecoder.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wangle/codec/StringCodec.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EchoHandler</span> : <span class="keyword">public</span> wangle::HandlerAdapter&lt;std::string&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(wangle::Context* ctx, std::string msg)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç®€å•çš„echoæœåŠ¡</span></span><br><span class="line">        ctx-&gt;<span class="built_in">fireWrite</span>(msg + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EchoPipelineFactory</span> : <span class="keyword">public</span> wangle::PipelineFactory&lt;wangle::DefaultPipeline&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    wangle::<span class="function">DefaultPipeline::Ptr <span class="title">newPipeline</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        std::shared_ptr&lt;folly::AsyncSocket&gt; sock)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> pipeline = wangle::DefaultPipeline::<span class="built_in">create</span>();</span><br><span class="line">        pipeline-&gt;<span class="built_in">addBack</span>(wangle::<span class="built_in">AsyncSocketHandler</span>(sock));</span><br><span class="line">        pipeline-&gt;<span class="built_in">addBack</span>(wangle::<span class="built_in">LineBasedFrameDecoder</span>(<span class="number">8192</span>));</span><br><span class="line">        pipeline-&gt;<span class="built_in">addBack</span>(wangle::<span class="built_in">StringCodec</span>());</span><br><span class="line">        pipeline-&gt;<span class="built_in">addBack</span>(<span class="built_in">EchoHandler</span>());</span><br><span class="line">        pipeline-&gt;<span class="built_in">finalize</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> pipeline;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    wangle::ServerBootstrap&lt;wangle::DefaultPipeline&gt; server;</span><br><span class="line">    server.<span class="built_in">childPipeline</span>(std::<span class="built_in">make_shared</span>&lt;EchoPipelineFactory&gt;());</span><br><span class="line">    server.<span class="built_in">bind</span>(<span class="number">8080</span>);</span><br><span class="line">    server.<span class="built_in">waitForStop</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”§-åºåˆ—åŒ–æ¡†æ¶åº”ç”¨åœºæ™¯"><a href="#ğŸ”§-åºåˆ—åŒ–æ¡†æ¶åº”ç”¨åœºæ™¯" class="headerlink" title="ğŸ”§ åºåˆ—åŒ–æ¡†æ¶åº”ç”¨åœºæ™¯"></a>ğŸ”§ åºåˆ—åŒ–æ¡†æ¶åº”ç”¨åœºæ™¯</h3><h4 id="FlatBuffers"><a href="#FlatBuffers" class="headerlink" title="FlatBuffers"></a>FlatBuffers</h4><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>æ¸¸æˆå¼€å‘</strong>ï¼šç½‘ç»œåè®®ã€å­˜æ¡£æ ¼å¼</li>
<li><strong>ç§»åŠ¨åº”ç”¨</strong>ï¼šå®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡</li>
<li><strong>å®æ—¶ç³»ç»Ÿ</strong>ï¼šä½å»¶è¿Ÿæ•°æ®ä¼ è¾“</li>
<li><strong>åµŒå…¥å¼ç³»ç»Ÿ</strong>ï¼šèµ„æºå—é™ç¯å¢ƒ</li>
</ul>
<p><strong>æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;flatbuffers/flatbuffers.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;google/protobuf/message.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FlatBuffers schema (game_data.fbs)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">table Player &#123;</span></span><br><span class="line"><span class="comment">    id:int;</span></span><br><span class="line"><span class="comment">    name:string;</span></span><br><span class="line"><span class="comment">    position:Vec3;</span></span><br><span class="line"><span class="comment">    health:int;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">table Vec3 &#123;</span></span><br><span class="line"><span class="comment">    x:float;</span></span><br><span class="line"><span class="comment">    y:float;</span></span><br><span class="line"><span class="comment">    z:float;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">root_type Player;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameDataSerializer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// FlatBuffersåºåˆ—åŒ– - é›¶æ‹·è´ï¼Œç›´æ¥è®¿é—®</span></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">uint8_t</span>&gt; <span class="title">serialize_with_flatbuffers</span><span class="params">(<span class="type">int</span> id, <span class="type">const</span> std::string&amp; name, </span></span></span><br><span class="line"><span class="params"><span class="function">                                                   <span class="type">float</span> x, <span class="type">float</span> y, <span class="type">float</span> z, <span class="type">int</span> health)</span> </span>&#123;</span><br><span class="line">        flatbuffers::FlatBufferBuilder builder;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> name_fb = builder.<span class="built_in">CreateString</span>(name);</span><br><span class="line">        <span class="keyword">auto</span> position = <span class="built_in">CreateVec3</span>(builder, x, y, z);</span><br><span class="line">        <span class="keyword">auto</span> player = <span class="built_in">CreatePlayer</span>(builder, id, name_fb, position, health);</span><br><span class="line">        </span><br><span class="line">        builder.<span class="built_in">Finish</span>(player);</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">vector</span>&lt;<span class="type">uint8_t</span>&gt;(builder.<span class="built_in">GetBufferPointer</span>(), </span><br><span class="line">                                   builder.<span class="built_in">GetBufferPointer</span>() + builder.<span class="built_in">GetSize</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ– - ç›´æ¥è®¿é—®ï¼Œæ— æ‹·è´</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deserialize_with_flatbuffers</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">uint8_t</span>&gt;&amp; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> player = flatbuffers::<span class="built_in">GetRoot</span>&lt;Player&gt;(data.<span class="built_in">data</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç›´æ¥è®¿é—®ï¼Œæ— æ‹·è´</span></span><br><span class="line">        <span class="type">int</span> id = player-&gt;<span class="built_in">id</span>();</span><br><span class="line">        std::string name = player-&gt;<span class="built_in">name</span>()-&gt;<span class="built_in">str</span>(); <span class="comment">// è¿™é‡Œä¼šæœ‰ä¸€æ¬¡æ‹·è´</span></span><br><span class="line">        <span class="type">float</span> x = player-&gt;<span class="built_in">position</span>()-&gt;<span class="built_in">x</span>();</span><br><span class="line">        <span class="type">float</span> y = player-&gt;<span class="built_in">position</span>()-&gt;<span class="built_in">y</span>();</span><br><span class="line">        <span class="type">float</span> z = player-&gt;<span class="built_in">position</span>()-&gt;<span class="built_in">z</span>();</span><br><span class="line">        <span class="type">int</span> health = player-&gt;<span class="built_in">health</span>();</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Player: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; z &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Protobufåºåˆ—åŒ– - éœ€è¦è§£æå’Œæ‹·è´</span></span><br><span class="line">    <span class="function">std::string <span class="title">serialize_with_protobuf</span><span class="params">(<span class="type">int</span> id, <span class="type">const</span> std::string&amp; name, </span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="type">float</span> x, <span class="type">float</span> y, <span class="type">float</span> z, <span class="type">int</span> health)</span> </span>&#123;</span><br><span class="line">        PlayerProto player;</span><br><span class="line">        player.<span class="built_in">set_id</span>(id);</span><br><span class="line">        player.<span class="built_in">set_name</span>(name);</span><br><span class="line">        player.<span class="built_in">mutable_position</span>()-&gt;<span class="built_in">set_x</span>(x);</span><br><span class="line">        player.<span class="built_in">mutable_position</span>()-&gt;<span class="built_in">set_y</span>(y);</span><br><span class="line">        player.<span class="built_in">mutable_position</span>()-&gt;<span class="built_in">set_z</span>(z);</span><br><span class="line">        player.<span class="built_in">set_health</span>(health);</span><br><span class="line">        </span><br><span class="line">        std::string data;</span><br><span class="line">        player.<span class="built_in">SerializeToString</span>(&amp;data);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deserialize_with_protobuf</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> </span>&#123;</span><br><span class="line">        PlayerProto player;</span><br><span class="line">        player.<span class="built_in">ParseFromString</span>(data);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¶‰åŠæ‹·è´</span></span><br><span class="line">        <span class="type">int</span> id = player.<span class="built_in">id</span>();</span><br><span class="line">        std::string name = player.<span class="built_in">name</span>(); <span class="comment">// æ‹·è´</span></span><br><span class="line">        <span class="type">float</span> x = player.<span class="built_in">position</span>().<span class="built_in">x</span>();</span><br><span class="line">        <span class="type">float</span> y = player.<span class="built_in">position</span>().<span class="built_in">y</span>();</span><br><span class="line">        <span class="type">float</span> z = player.<span class="built_in">position</span>().<span class="built_in">z</span>();</span><br><span class="line">        <span class="type">int</span> health = player.<span class="built_in">health</span>();</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Player: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; z &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ—ï¸-å…·ä½“ä¸šåŠ¡åœºæ™¯æ¶æ„ç»„åˆ"><a href="#ğŸ—ï¸-å…·ä½“ä¸šåŠ¡åœºæ™¯æ¶æ„ç»„åˆ" class="headerlink" title="ğŸ—ï¸ å…·ä½“ä¸šåŠ¡åœºæ™¯æ¶æ„ç»„åˆ"></a>ğŸ—ï¸ å…·ä½“ä¸šåŠ¡åœºæ™¯æ¶æ„ç»„åˆ</h2><h3 id="1-ç”µå•†ç³»ç»Ÿæ¶æ„"><a href="#1-ç”µå•†ç³»ç»Ÿæ¶æ„" class="headerlink" title="1. ç”µå•†ç³»ç»Ÿæ¶æ„"></a>1. ç”µå•†ç³»ç»Ÿæ¶æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‰ç«¯ -&gt; APIç½‘å…³(Wangle) -&gt; ç”¨æˆ·æœåŠ¡(gRPC) -&gt; æ•°æ®åº“</span><br><span class="line">                â†“</span><br><span class="line">        è®¢å•æœåŠ¡(gRPC) -&gt; åº“å­˜æœåŠ¡(gRPC)</span><br><span class="line">                â†“</span><br><span class="line">        æ”¯ä»˜æœåŠ¡(gRPC) -&gt; æ¶ˆæ¯é˜Ÿåˆ—(Kafka) -&gt; ç‰©æµç³»ç»Ÿ</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>APIç½‘å…³</strong>ï¼šä½¿ç”¨Wangleå¤„ç†è·¯ç”±ã€è®¤è¯ã€é™æµ</li>
<li><strong>æœåŠ¡é—´é€šä¿¡</strong>ï¼šgRPC + Protobufç¡®ä¿é«˜æ€§èƒ½</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šKafkaå¤„ç†è®¢å•çŠ¶æ€å˜æ›´ã€åº“å­˜æ›´æ–°</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æœ€ç»ˆä¸€è‡´æ€§</li>
</ul>
<h3 id="2-é‡‘èäº¤æ˜“ç³»ç»Ÿæ¶æ„"><a href="#2-é‡‘èäº¤æ˜“ç³»ç»Ÿæ¶æ„" class="headerlink" title="2. é‡‘èäº¤æ˜“ç³»ç»Ÿæ¶æ„"></a>2. é‡‘èäº¤æ˜“ç³»ç»Ÿæ¶æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">äº¤æ˜“ç»ˆç«¯ -&gt; è®¢å•è·¯ç”±(ZeroMQ) -&gt; é£æ§ç³»ç»Ÿ(gRPC)</span><br><span class="line">                â†“</span><br><span class="line">        æ‰§è¡Œå¼•æ“(å…±äº«å†…å­˜) -&gt; æ¸…ç®—ç³»ç»Ÿ(Kafka)</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä½å»¶è¿Ÿ</strong>ï¼šZeroMQæä¾›å¾®ç§’çº§å»¶è¿Ÿ</li>
<li><strong>å®æ—¶é£æ§</strong>ï¼šgRPCç¡®ä¿é£æ§æ£€æŸ¥çš„å®æ—¶æ€§</li>
<li><strong>é«˜æ€§èƒ½æ‰§è¡Œ</strong>ï¼šå…±äº«å†…å­˜å‡å°‘åºåˆ—åŒ–å¼€é”€</li>
<li><strong>æ•°æ®æŒä¹…åŒ–</strong>ï¼šKafkaä¿è¯äº¤æ˜“æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<h3 id="3-æ¸¸æˆæœåŠ¡å™¨æ¶æ„"><a href="#3-æ¸¸æˆæœåŠ¡å™¨æ¶æ„" class="headerlink" title="3. æ¸¸æˆæœåŠ¡å™¨æ¶æ„"></a>3. æ¸¸æˆæœåŠ¡å™¨æ¶æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ¸¸æˆå®¢æˆ·ç«¯ -&gt; ç½‘å…³æœåŠ¡å™¨(libgo) -&gt; æ¸¸æˆé€»è¾‘æœåŠ¡å™¨</span><br><span class="line">                â†“</span><br><span class="line">        èŠå¤©ç³»ç»Ÿ(ZeroMQ) -&gt; æ•°æ®åº“</span><br><span class="line">                â†“</span><br><span class="line">        æ’è¡Œæ¦œç³»ç»Ÿ(Redis) -&gt; æ•°æ®åˆ†æ(Kafka)</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>é«˜å¹¶å‘</strong>ï¼šlibgoåç¨‹å¤„ç†å¤§é‡è¿æ¥</li>
<li><strong>å®æ—¶é€šä¿¡</strong>ï¼šZeroMQå¤„ç†èŠå¤©å’ŒçŠ¶æ€åŒæ­¥</li>
<li><strong>æ’è¡Œæ¦œ</strong>ï¼šRedisæä¾›é«˜æ€§èƒ½ç¼“å­˜</li>
<li><strong>æ•°æ®åˆ†æ</strong>ï¼šKafkaæ”¶é›†ç©å®¶è¡Œä¸ºæ•°æ®</li>
</ul>
<h3 id="4-IoTå¹³å°æ¶æ„"><a href="#4-IoTå¹³å°æ¶æ„" class="headerlink" title="4. IoTå¹³å°æ¶æ„"></a>4. IoTå¹³å°æ¶æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¼ æ„Ÿå™¨ -&gt; è¾¹ç¼˜è®¡ç®—(DDS) -&gt; äº‘ç«¯å¤„ç†(Kafka)</span><br><span class="line">                â†“</span><br><span class="line">        æ•°æ®åˆ†æ(gRPC) -&gt; å­˜å‚¨ç³»ç»Ÿ</span><br><span class="line">                â†“</span><br><span class="line">        å‘Šè­¦ç³»ç»Ÿ(ZeroMQ) -&gt; é€šçŸ¥æœåŠ¡</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å®æ—¶é€šä¿¡</strong>ï¼šDDSå¤„ç†ä¼ æ„Ÿå™¨æ•°æ®åˆ†å‘</li>
<li><strong>æ•°æ®æ”¶é›†</strong>ï¼šKafkaå¤„ç†å¤§é‡IoTæ•°æ®</li>
<li><strong>åˆ†æå¤„ç†</strong>ï¼šgRPCè°ƒç”¨æœºå™¨å­¦ä¹ æ¨¡å‹</li>
<li><strong>å‘Šè­¦é€šçŸ¥</strong>ï¼šZeroMQç¡®ä¿å‘Šè­¦åŠæ—¶é€è¾¾</li>
</ul>
<hr>
<h2 id="ğŸ’¡-ä¸­é—´ä»¶é€‰æ‹©æŒ‡å—"><a href="#ğŸ’¡-ä¸­é—´ä»¶é€‰æ‹©æŒ‡å—" class="headerlink" title="ğŸ’¡ ä¸­é—´ä»¶é€‰æ‹©æŒ‡å—"></a>ğŸ’¡ ä¸­é—´ä»¶é€‰æ‹©æŒ‡å—</h2><h3 id="æ€§èƒ½éœ€æ±‚å¯¼å‘"><a href="#æ€§èƒ½éœ€æ±‚å¯¼å‘" class="headerlink" title="æ€§èƒ½éœ€æ±‚å¯¼å‘"></a>æ€§èƒ½éœ€æ±‚å¯¼å‘</h3><ol>
<li><strong>é«˜ååé‡åœºæ™¯</strong>ï¼šKafka + gRPC</li>
<li><strong>ä½å»¶è¿Ÿåœºæ™¯</strong>ï¼šZeroMQ + FlatBuffers</li>
<li><strong>å®æ—¶ç³»ç»Ÿ</strong>ï¼šDDS + å…±äº«å†…å­˜</li>
<li><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šgRPC + Protobuf</li>
<li><strong>é«˜å¹¶å‘Web</strong>ï¼šlibgo + Restbed</li>
<li><strong>å¤§æ•°æ®å¤„ç†</strong>ï¼šKafka + è‡ªå®šä¹‰åºåˆ—åŒ–</li>
</ol>
<h3 id="æŠ€æœ¯æ ˆè€ƒè™‘"><a href="#æŠ€æœ¯æ ˆè€ƒè™‘" class="headerlink" title="æŠ€æœ¯æ ˆè€ƒè™‘"></a>æŠ€æœ¯æ ˆè€ƒè™‘</h3><ul>
<li><strong>å›¢é˜Ÿç†Ÿæ‚‰åº¦</strong>ï¼šé€‰æ‹©å›¢é˜Ÿç†Ÿæ‚‰çš„ä¸­é—´ä»¶</li>
<li><strong>ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šè€ƒè™‘å‘¨è¾¹å·¥å…·å’Œç¤¾åŒºæ”¯æŒ</li>
<li><strong>ç»´æŠ¤æˆæœ¬</strong>ï¼šè¯„ä¼°è¿ç»´å’Œç›‘æ§å¤æ‚åº¦</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šè€ƒè™‘æœªæ¥ä¸šåŠ¡å¢é•¿éœ€æ±‚</li>
</ul>
<h3 id="æˆæœ¬æ•ˆç›Šåˆ†æ"><a href="#æˆæœ¬æ•ˆç›Šåˆ†æ" class="headerlink" title="æˆæœ¬æ•ˆç›Šåˆ†æ"></a>æˆæœ¬æ•ˆç›Šåˆ†æ</h3><ul>
<li><strong>å¼€å‘æˆæœ¬</strong>ï¼šå­¦ä¹ æ›²çº¿å’Œå¼€å‘æ—¶é—´</li>
<li><strong>è¿ç»´æˆæœ¬</strong>ï¼šéƒ¨ç½²ã€ç›‘æ§ã€ç»´æŠ¤</li>
<li><strong>æ€§èƒ½æ”¶ç›Š</strong>ï¼šå»¶è¿Ÿé™ä½ã€ååé‡æå‡</li>
<li><strong>ä¸šåŠ¡ä»·å€¼</strong>ï¼šç”¨æˆ·ä½“éªŒæ”¹å–„ã€æˆæœ¬èŠ‚çº¦</li>
</ul>
<hr>
<h2 id="ğŸ”§-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"><a href="#ğŸ”§-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ" class="headerlink" title="ğŸ”§ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"></a>ğŸ”§ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ</h2><h3 id="1-ç½‘ç»œä¼˜åŒ–"><a href="#1-ç½‘ç»œä¼˜åŒ–" class="headerlink" title="1. ç½‘ç»œä¼˜åŒ–"></a>1. ç½‘ç»œä¼˜åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionPool</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::queue&lt;std::shared_ptr&lt;grpc::Channel&gt;&gt; connections_;</span><br><span class="line">    std::mutex mutex_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::shared_ptr&lt;grpc::Channel&gt; <span class="title">get_connection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (connections_.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> grpc::<span class="built_in">CreateChannel</span>(<span class="string">&quot;localhost:50051&quot;</span>, </span><br><span class="line">                                     grpc::<span class="built_in">InsecureChannelCredentials</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> conn = connections_.<span class="built_in">front</span>();</span><br><span class="line">        connections_.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">return_connection</span><span class="params">(std::shared_ptr&lt;grpc::Channel&gt; conn)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        connections_.<span class="built_in">push</span>(conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-å†…å­˜ä¼˜åŒ–"><a href="#2-å†…å­˜ä¼˜åŒ–" class="headerlink" title="2. å†…å­˜ä¼˜åŒ–"></a>2. å†…å­˜ä¼˜åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹è±¡æ± æ¨¡å¼</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectPool</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::queue&lt;std::unique_ptr&lt;T&gt;&gt; pool_;</span><br><span class="line">    std::mutex mutex_;</span><br><span class="line">    std::function&lt;std::unique_ptr&lt;T&gt;()&gt; factory_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="title">ObjectPool</span><span class="params">(<span class="type">size_t</span> initial_size, Args&amp;&amp;... args)</span> </span>&#123;</span><br><span class="line">        factory_ = [args...]() &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_unique</span>&lt;T&gt;(std::forward&lt;Args&gt;(args)...);</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; initial_size; ++i) &#123;</span><br><span class="line">            pool_.<span class="built_in">push</span>(<span class="built_in">factory_</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::unique_ptr&lt;T&gt; <span class="title">acquire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (pool_.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">factory_</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> obj = std::<span class="built_in">move</span>(pool_.<span class="built_in">front</span>());</span><br><span class="line">        pool_.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">release</span><span class="params">(std::unique_ptr&lt;T&gt; obj)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        pool_.<span class="built_in">push</span>(std::<span class="built_in">move</span>(obj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-å¹¶å‘ä¼˜åŒ–"><a href="#3-å¹¶å‘ä¼˜åŒ–" class="headerlink" title="3. å¹¶å‘ä¼˜åŒ–"></a>3. å¹¶å‘ä¼˜åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— é”ç¯å½¢ç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="type">size_t</span> Size&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LockFreeRingBuffer</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::array&lt;T, Size&gt; buffer_;</span><br><span class="line">    std::atomic&lt;<span class="type">size_t</span>&gt; head_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    std::atomic&lt;<span class="type">size_t</span>&gt; tail_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">push</span><span class="params">(<span class="type">const</span> T&amp; item)</span> </span>&#123;</span><br><span class="line">        <span class="type">size_t</span> current_tail = tail_.<span class="built_in">load</span>(std::memory_order_relaxed);</span><br><span class="line">        <span class="type">size_t</span> next_tail = (current_tail + <span class="number">1</span>) % Size;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (next_tail == head_.<span class="built_in">load</span>(std::memory_order_acquire)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ç¼“å†²åŒºæ»¡</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        buffer_[current_tail] = item;</span><br><span class="line">        tail_.<span class="built_in">store</span>(next_tail, std::memory_order_release);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">pop</span><span class="params">(T&amp; item)</span> </span>&#123;</span><br><span class="line">        <span class="type">size_t</span> current_head = head_.<span class="built_in">load</span>(std::memory_order_relaxed);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (current_head == tail_.<span class="built_in">load</span>(std::memory_order_acquire)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ç¼“å†²åŒºç©º</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        item = buffer_[current_head];</span><br><span class="line">        head_.<span class="built_in">store</span>((current_head + <span class="number">1</span>) % Size, std::memory_order_release);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“Š-æ€§èƒ½åŸºå‡†æµ‹è¯•"><a href="#ğŸ“Š-æ€§èƒ½åŸºå‡†æµ‹è¯•" class="headerlink" title="ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•"></a>ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•</h2><h3 id="å»¶è¿Ÿå¯¹æ¯”"><a href="#å»¶è¿Ÿå¯¹æ¯”" class="headerlink" title="å»¶è¿Ÿå¯¹æ¯”"></a>å»¶è¿Ÿå¯¹æ¯”</h3><table>
<thead>
<tr>
<th>ä¸­é—´ä»¶</th>
<th>å¹³å‡å»¶è¿Ÿ</th>
<th>99%å»¶è¿Ÿ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>ZeroMQ</td>
<td>10-50Î¼s</td>
<td>100Î¼s</td>
<td>å®æ—¶é€šä¿¡</td>
</tr>
<tr>
<td>gRPC</td>
<td>100-500Î¼s</td>
<td>1ms</td>
<td>å¾®æœåŠ¡è°ƒç”¨</td>
</tr>
<tr>
<td>Kafka</td>
<td>1-5ms</td>
<td>10ms</td>
<td>æ¶ˆæ¯é˜Ÿåˆ—</td>
</tr>
<tr>
<td>Redis</td>
<td>50-200Î¼s</td>
<td>500Î¼s</td>
<td>ç¼“å­˜</td>
</tr>
</tbody></table>
<h3 id="ååé‡å¯¹æ¯”"><a href="#ååé‡å¯¹æ¯”" class="headerlink" title="ååé‡å¯¹æ¯”"></a>ååé‡å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>ä¸­é—´ä»¶</th>
<th>å•æœºååé‡</th>
<th>é›†ç¾¤ååé‡</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>ZeroMQ</td>
<td>1M msg&#x2F;s</td>
<td>10M msg&#x2F;s</td>
<td>é«˜é¢‘äº¤æ˜“</td>
</tr>
<tr>
<td>gRPC</td>
<td>100K req&#x2F;s</td>
<td>1M req&#x2F;s</td>
<td>APIæœåŠ¡</td>
</tr>
<tr>
<td>Kafka</td>
<td>1M msg&#x2F;s</td>
<td>100M msg&#x2F;s</td>
<td>æµå¤„ç†</td>
</tr>
<tr>
<td>Redis</td>
<td>100K ops&#x2F;s</td>
<td>1M ops&#x2F;s</td>
<td>ç¼“å­˜æœåŠ¡</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ¯-é«˜æ€§èƒ½ç¼–ç¨‹æ¨èç»„åˆç¤ºä¾‹ï¼š"><a href="#ğŸ¯-é«˜æ€§èƒ½ç¼–ç¨‹æ¨èç»„åˆç¤ºä¾‹ï¼š" class="headerlink" title="ğŸ¯ é«˜æ€§èƒ½ç¼–ç¨‹æ¨èç»„åˆç¤ºä¾‹ï¼š"></a>ğŸ¯ é«˜æ€§èƒ½ç¼–ç¨‹æ¨èç»„åˆç¤ºä¾‹ï¼š</h2><ul>
<li><p>âœ… é«˜åå RPCï¼š<code>brpc</code> + <code>Protobuf</code></p>
</li>
<li><p>âœ… å¾®æœåŠ¡é€šä¿¡ï¼š<code>gRPC</code> + <code>Protobuf/FlatBuffers</code></p>
</li>
<li><p>âœ… è¶…ä½å»¶è¿Ÿé€šä¿¡ï¼š<code>ZeroMQ</code> + <code>FlatBuffers</code></p>
</li>
<li><p>âœ… å®æ—¶ç³»ç»Ÿï¼ˆè½¦è½½&#x2F;å†›å·¥ï¼‰ï¼š<code>DDSï¼ˆRTI/Openspliceï¼‰</code></p>
</li>
<li><p>âœ… æœ¬åœ°é«˜æ€§èƒ½è¿›ç¨‹é€šä¿¡ï¼š<code>mmap</code> + è‡ªå®šä¹‰ ring buffer</p>
</li>
<li><p>âœ… é«˜å¹¶å‘åç¨‹æ¡†æ¶ï¼š<code>libgo</code> æˆ– <code>Seastar</code></p>
</li>
</ul>
<hr>
<h2 id="ğŸš€-éƒ¨ç½²å’Œè¿ç»´æŒ‡å—"><a href="#ğŸš€-éƒ¨ç½²å’Œè¿ç»´æŒ‡å—" class="headerlink" title="ğŸš€ éƒ¨ç½²å’Œè¿ç»´æŒ‡å—"></a>ğŸš€ éƒ¨ç½²å’Œè¿ç»´æŒ‡å—</h2><h3 id="1-å®¹å™¨åŒ–éƒ¨ç½²"><a href="#1-å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="1. å®¹å™¨åŒ–éƒ¨ç½²"></a>1. å®¹å™¨åŒ–éƒ¨ç½²</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile for C++ middleware application</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">20.04</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install dependencies</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    build-essential \</span></span><br><span class="line"><span class="language-bash">    cmake \</span></span><br><span class="line"><span class="language-bash">    libboost-all-dev \</span></span><br><span class="line"><span class="language-bash">    libgrpc++-dev \</span></span><br><span class="line"><span class="language-bash">    libprotobuf-dev \</span></span><br><span class="line"><span class="language-bash">    libzmq3-dev \</span></span><br><span class="line"><span class="language-bash">    libcppkafka-dev \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy source code</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build application</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; cmake .. \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; make -j$(<span class="built_in">nproc</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run application</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;./build/myapp&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="2-ç›‘æ§å’ŒæŒ‡æ ‡"><a href="#2-ç›‘æ§å’ŒæŒ‡æ ‡" class="headerlink" title="2. ç›‘æ§å’ŒæŒ‡æ ‡"></a>2. ç›‘æ§å’ŒæŒ‡æ ‡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€§èƒ½æŒ‡æ ‡æ”¶é›†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::atomic&lt;<span class="type">uint64_t</span>&gt; request_count_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    std::atomic&lt;<span class="type">uint64_t</span>&gt; error_count_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    std::atomic&lt;<span class="type">uint64_t</span>&gt; total_latency_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">record_request</span><span class="params">(<span class="type">uint64_t</span> latency_ns)</span> </span>&#123;</span><br><span class="line">        request_count_.<span class="built_in">fetch_add</span>(<span class="number">1</span>);</span><br><span class="line">        total_latency_.<span class="built_in">fetch_add</span>(latency_ns);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">record_error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        error_count_.<span class="built_in">fetch_add</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">get_avg_latency_ms</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="type">uint64_t</span> count = request_count_.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">return</span> (total_latency_.<span class="built_in">load</span>() / count) / <span class="number">1000000.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">get_error_rate</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="type">uint64_t</span> requests = request_count_.<span class="built_in">load</span>();</span><br><span class="line">        <span class="type">uint64_t</span> errors = error_count_.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">if</span> (requests == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(errors) / requests;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-é…ç½®ç®¡ç†"><a href="#3-é…ç½®ç®¡ç†" class="headerlink" title="3. é…ç½®ç®¡ç†"></a>3. é…ç½®ç®¡ç†</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½®ç®¡ç†ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unordered_map&lt;std::string, std::string&gt; config_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">load_from_file</span><span class="params">(<span class="type">const</span> std::string&amp; filename)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::ifstream <span class="title">file</span><span class="params">(filename)</span></span>;</span><br><span class="line">        std::string line;</span><br><span class="line">        <span class="keyword">while</span> (std::<span class="built_in">getline</span>(file, line)) &#123;</span><br><span class="line">            <span class="type">size_t</span> pos = line.<span class="built_in">find</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (pos != std::string::npos) &#123;</span><br><span class="line">                std::string key = line.<span class="built_in">substr</span>(<span class="number">0</span>, pos);</span><br><span class="line">                std::string value = line.<span class="built_in">substr</span>(pos + <span class="number">1</span>);</span><br><span class="line">                config_[key] = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    T <span class="title">get</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> T&amp; default_value = T&#123;&#125;)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = config_.<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (it == config_.<span class="built_in">end</span>()) <span class="keyword">return</span> default_value;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T, <span class="type">int</span>&gt;)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">stoi</span>(it-&gt;second);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">double</span>&gt;) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">stod</span>(it-&gt;second);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T&gt;(it-&gt;second);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”-æ•…éšœæ’æŸ¥å’Œè°ƒè¯•"><a href="#ğŸ”-æ•…éšœæ’æŸ¥å’Œè°ƒè¯•" class="headerlink" title="ğŸ” æ•…éšœæ’æŸ¥å’Œè°ƒè¯•"></a>ğŸ” æ•…éšœæ’æŸ¥å’Œè°ƒè¯•</h2><h3 id="1-å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#1-å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="1. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>1. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3><h4 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’ŒRAII</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResourceManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;zmq::<span class="type">context_t</span>&gt; context_;</span><br><span class="line">    std::unique_ptr&lt;zmq::<span class="type">socket_t</span>&gt; socket_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ResourceManager</span>() : <span class="built_in">context_</span>(std::<span class="built_in">make_unique</span>&lt;zmq::<span class="type">context_t</span>&gt;(<span class="number">1</span>)) &#123;</span><br><span class="line">        socket_ = std::<span class="built_in">make_unique</span>&lt;zmq::<span class="type">socket_t</span>&gt;(*context_, ZMQ_REQ);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªåŠ¨æ¸…ç†èµ„æº</span></span><br><span class="line">    ~<span class="built_in">ResourceManager</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="æ­»é”æ£€æµ‹"><a href="#æ­»é”æ£€æµ‹" class="headerlink" title="æ­»é”æ£€æµ‹"></a>æ­»é”æ£€æµ‹</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­»é”æ£€æµ‹å·¥å…·</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeadlockDetector</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unordered_map&lt;std::thread::id, std::vector&lt;std::string&gt;&gt; thread_locks_;</span><br><span class="line">    std::mutex detector_mutex_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">record_lock_attempt</span><span class="params">(<span class="type">const</span> std::string&amp; lock_name)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(detector_mutex_)</span></span>;</span><br><span class="line">        <span class="keyword">auto</span> thread_id = std::this_thread::<span class="built_in">get_id</span>();</span><br><span class="line">        thread_locks_[thread_id].<span class="built_in">push_back</span>(lock_name);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æµ‹æ­»é”</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">detect_deadlock</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Potential deadlock detected!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">detect_deadlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç®€åŒ–çš„æ­»é”æ£€æµ‹ç®—æ³•</span></span><br><span class="line">        <span class="comment">// å®é™…å®ç°éœ€è¦æ›´å¤æ‚çš„å›¾ç®—æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-æ€§èƒ½è°ƒä¼˜æŠ€å·§"><a href="#2-æ€§èƒ½è°ƒä¼˜æŠ€å·§" class="headerlink" title="2. æ€§èƒ½è°ƒä¼˜æŠ€å·§"></a>2. æ€§èƒ½è°ƒä¼˜æŠ€å·§</h3><h4 id="ç¼–è¯‘ä¼˜åŒ–"><a href="#ç¼–è¯‘ä¼˜åŒ–" class="headerlink" title="ç¼–è¯‘ä¼˜åŒ–"></a>ç¼–è¯‘ä¼˜åŒ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘ä¼˜åŒ–è„šæœ¬</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;-O3 -march=native -mtune=native -flto -DNDEBUG&quot;</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-flto&quot;</span></span><br><span class="line"></span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -DCMAKE_CXX_FLAGS=<span class="string">&quot;<span class="variable">$CXXFLAGS</span>&quot;</span> \</span><br><span class="line">      -DCMAKE_EXE_LINKER_FLAGS=<span class="string">&quot;<span class="variable">$LDFLAGS</span>&quot;</span> \</span><br><span class="line">      ..</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œæ—¶ä¼˜åŒ–"><a href="#è¿è¡Œæ—¶ä¼˜åŒ–" class="headerlink" title="è¿è¡Œæ—¶ä¼˜åŒ–"></a>è¿è¡Œæ—¶ä¼˜åŒ–</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¿ç¨‹äº²å’Œæ€§è®¾ç½®</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_thread_affinity</span><span class="params">(<span class="type">int</span> cpu_id)</span> </span>&#123;</span><br><span class="line">    <span class="type">cpu_set_t</span> cpuset;</span><br><span class="line">    <span class="built_in">CPU_ZERO</span>(&amp;cpuset);</span><br><span class="line">    <span class="built_in">CPU_SET</span>(cpu_id, &amp;cpuset);</span><br><span class="line">    <span class="built_in">pthread_setaffinity_np</span>(<span class="built_in">pthread_self</span>(), <span class="built_in">sizeof</span>(<span class="type">cpu_set_t</span>), &amp;cpuset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NUMAæ„ŸçŸ¥å†…å­˜åˆ†é…</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">numa_alloc</span><span class="params">(<span class="type">size_t</span> size, <span class="type">int</span> numa_node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">numa_alloc_onnode</span>(size, numa_node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ“š-å­¦ä¹ èµ„æºæ¨è"><a href="#ğŸ“š-å­¦ä¹ èµ„æºæ¨è" class="headerlink" title="ğŸ“š å­¦ä¹ èµ„æºæ¨è"></a>ğŸ“š å­¦ä¹ èµ„æºæ¨è</h2><h3 id="1-å®˜æ–¹æ–‡æ¡£"><a href="#1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="1. å®˜æ–¹æ–‡æ¡£"></a>1. å®˜æ–¹æ–‡æ¡£</h3><ul>
<li><a target="_blank" rel="noopener" href="http://zguide.zeromq.org/">ZeroMQ Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://grpc.io/docs/">gRPC Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://kafka.apache.org/documentation/">Apache Kafka Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/master/doc/html/boost_asio.html">Boost.Asio Documentation</a></li>
</ul>
<h3 id="2-ä¹¦ç±æ¨è"><a href="#2-ä¹¦ç±æ¨è" class="headerlink" title="2. ä¹¦ç±æ¨è"></a>2. ä¹¦ç±æ¨è</h3><ul>
<li>ã€ŠZeroMQ: Messaging for Many Applicationsã€‹</li>
<li>ã€ŠgRPC: Up and Runningã€‹</li>
<li>ã€ŠHigh Performance Browser Networkingã€‹</li>
<li>ã€ŠC++ Concurrency in Actionã€‹</li>
</ul>
<h3 id="3-å¼€æºé¡¹ç›®å­¦ä¹ "><a href="#3-å¼€æºé¡¹ç›®å­¦ä¹ " class="headerlink" title="3. å¼€æºé¡¹ç›®å­¦ä¹ "></a>3. å¼€æºé¡¹ç›®å­¦ä¹ </h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/scylladb/scylla">ScyllaDB</a> - åŸºäºSeastarçš„NoSQLæ•°æ®åº“</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/brpc">brpc</a> - ç™¾åº¦RPCæ¡†æ¶</li>
<li><a target="_blank" rel="noopener" href="https://github.com/yyzybb537/libgo">libgo</a> - è…¾è®¯åç¨‹åº“</li>
</ul>
<h2 id="ğŸ¯-æ€»ç»“"><a href="#ğŸ¯-æ€»ç»“" class="headerlink" title="ğŸ¯ æ€»ç»“"></a>ğŸ¯ æ€»ç»“</h2><p>é€‰æ‹©åˆé€‚çš„C++ä¸­é—´ä»¶éœ€è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š</p>
<ol>
<li><strong>æ€§èƒ½éœ€æ±‚</strong>ï¼šå»¶è¿Ÿã€ååé‡ã€å¹¶å‘é‡</li>
<li><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šå®æ—¶æ€§ã€å¯é æ€§ã€æ‰©å±•æ€§</li>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼šå›¢é˜ŸæŠ€èƒ½ã€ç»´æŠ¤æˆæœ¬</li>
<li><strong>ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šç¤¾åŒºæ”¯æŒã€å·¥å…·é“¾å®Œå–„åº¦</li>
</ol>
<p>è®°ä½ï¼Œ<strong>è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº</strong>ã€‚åº”è¯¥å…ˆç¡®ä¿ç³»ç»Ÿæ­£ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œç„¶åé€šè¿‡profilingæ‰¾åˆ°çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆï¼Œå†æœ‰é’ˆå¯¹æ€§åœ°é€‰æ‹©å’Œä½¿ç”¨ä¸­é—´ä»¶ã€‚</p>
<hr>
<p>å¦‚æœä½ æœ‰å…·ä½“åœºæ™¯ï¼ˆå¦‚ï¼š<strong>å¤šçº¿ç¨‹å¤„ç†ã€ç½‘ç»œé€šä¿¡ã€åˆ†å¸ƒå¼è°ƒåº¦ã€å¾®æœåŠ¡è°ƒç”¨ç­‰</strong>ï¼‰ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥æ¨èé€‚é…çš„ä¸­é—´ä»¶ç»„åˆã€‚éœ€è¦çš„è¯å¯ä»¥è¯¦ç»†è¯´æ˜ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/07/07/Programming/CPP/middle-layers%20for%20high%20performance%20cpp/" data-id="cme178g8t003cy8onatx4e4df" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/07/07/Programming/CPP/gRPC%20vs%20restful/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2025/07/07/Programming/CPP/high%20performance%20programming/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/System/">System</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Test/">Test</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/" rel="tag">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Attention/" rel="tag">Attention</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Communication/" rel="tag">Communication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Compiler/" rel="tag">Compiler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Computational-Graph/" rel="tag">Computational Graph</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DeepSeek/" rel="tag">DeepSeek</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Distributed/" rel="tag">Distributed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLM/" rel="tag">LLM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MoE/" rel="tag">MoE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optimization/" rel="tag">Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SGLang/" rel="tag">SGLang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/System/" rel="tag">System</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blues/" rel="tag">blues</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/career/" rel="tag">career</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/charts/" rel="tag">charts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/consensus/" rel="tag">consensus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-parallelism/" rel="tag">data-parallelism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/distributed-systems/" rel="tag">distributed-systems</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/experience/" rel="tag">experience</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/expert-parallelism/" rel="tag">expert-parallelism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/guitar/" rel="tag">guitar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/harmony/" rel="tag">harmony</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/licks/" rel="tag">licks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/llm/" rel="tag">llm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mermaid/" rel="tag">mermaid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raft/" rel="tag">raft</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rhythm/" rel="tag">rhythm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AI/" style="font-size: 10px;">AI</a> <a href="/tags/Attention/" style="font-size: 10px;">Attention</a> <a href="/tags/Communication/" style="font-size: 10px;">Communication</a> <a href="/tags/Compiler/" style="font-size: 10px;">Compiler</a> <a href="/tags/Computational-Graph/" style="font-size: 10px;">Computational Graph</a> <a href="/tags/DeepSeek/" style="font-size: 10px;">DeepSeek</a> <a href="/tags/Distributed/" style="font-size: 10px;">Distributed</a> <a href="/tags/LLM/" style="font-size: 10px;">LLM</a> <a href="/tags/MoE/" style="font-size: 10px;">MoE</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/Performance/" style="font-size: 10px;">Performance</a> <a href="/tags/SGLang/" style="font-size: 10px;">SGLang</a> <a href="/tags/System/" style="font-size: 15px;">System</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/blues/" style="font-size: 20px;">blues</a> <a href="/tags/career/" style="font-size: 10px;">career</a> <a href="/tags/charts/" style="font-size: 10px;">charts</a> <a href="/tags/consensus/" style="font-size: 10px;">consensus</a> <a href="/tags/data-parallelism/" style="font-size: 10px;">data-parallelism</a> <a href="/tags/distributed-systems/" style="font-size: 20px;">distributed-systems</a> <a href="/tags/experience/" style="font-size: 10px;">experience</a> <a href="/tags/expert-parallelism/" style="font-size: 10px;">expert-parallelism</a> <a href="/tags/guitar/" style="font-size: 20px;">guitar</a> <a href="/tags/harmony/" style="font-size: 10px;">harmony</a> <a href="/tags/licks/" style="font-size: 10px;">licks</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/llm/" style="font-size: 15px;">llm</a> <a href="/tags/mermaid/" style="font-size: 10px;">mermaid</a> <a href="/tags/raft/" style="font-size: 10px;">raft</a> <a href="/tags/rhythm/" style="font-size: 10px;">rhythm</a> <a href="/tags/test/" style="font-size: 10px;">test</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">July 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/08/03/Plans/%E5%B7%A5%E4%BD%9C%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%9A%BE%E9%A2%98/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/08/02/System/LLM%20Serving%20Configs/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/07/31/System/cuda-kernel/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/07/31/Programming/CPP/constexpr/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/07/30/System/%E5%B9%B6%E8%A1%8C%E7%AD%96%E7%95%A5/%E5%BA%8F%E5%88%97%E5%B9%B6%E8%A1%8C/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






<!-- Mermaid Support -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'default',
    securityLevel: 'loose',
    themeVariables: {
      primaryColor: '#0f4c75',
      primaryTextColor: '#fff',
      primaryBorderColor: '#0f4c75',
      lineColor: '#0f4c75',
      secondaryColor: '#006ba6',
      tertiaryColor: '#fff'
    }
  });
</script>
  </div>
</body>
</html>